<!DOCTYPE html>
<html lang="en">


<!-- Mirrored from techzaa.in/larkon/admin/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 03 Dec 2024 05:41:47 GMT -->
<head>
     <!-- Title Meta -->
     <meta charset="utf-8" />
     <title>Expansy || Dashboard</title>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta name="description" content="A fully responsive premium admin dashboard template" />
     <meta name="author" content="Techzaa" />
     <meta http-equiv="X-UA-Compatible" content="IE=edge" />

     <!-- App favicon -->
     <link rel="shortcut icon" href="/assets/images/favicon.ico">

     <!-- Vendor css (Require in all Page) -->
     <link href="/assets/css/vendor.min.css" rel="stylesheet" type="text/css" />

     <!-- Icons css (Require in all Page) -->
     <link href="/assets/css/icons.min.css" rel="stylesheet" type="text/css" />

     <!-- App css (Require in all Page) -->
     <link href="/assets/css/app.min.css" rel="stylesheet" type="text/css" />

     <!-- Theme Config js (Require in all Page) -->
     <script src="/assets/js/config.js"></script>
</head>

<body>

     <!-- START Wrapper -->
     <div class="wrapper">

          <!-- ========== Topbar Start ========== -->
          <header class="topbar">
               <div class="container-fluid">
                    <div class="navbar-header">
                         <div class="d-flex align-items-center">
                              <!-- Menu Toggle Button -->
                              <div class="topbar-item">
                                   <button type="button" class="button-toggle-menu me-2">
                                        <iconify-icon icon="solar:hamburger-menu-broken" class="fs-24 align-middle"></iconify-icon>
                                   </button>
                              </div>

                              <!-- Menu Toggle Button -->
                              <div class="topbar-item">
                                   <h4 class="fw-bold topbar-button pe-none text-uppercase mb-0">Welcome Admin!</h4>
                              </div>
                         </div>

                         <div class="d-flex align-items-center gap-1">

                              

                              <!-- Notification -->
                              <div class="dropdown topbar-item">
                                   
                                   <div class="dropdown-menu py-0 dropdown-lg dropdown-menu-end" aria-labelledby="page-header-notifications-dropdown">
                                        
                                        <div data-simplebar style="max-height: 280px;">
                                             <!-- Item -->
                                             
                                             <!-- Item -->
                                             <a href="javascript:void(0);" class="dropdown-item py-3 border-bottom">
                                                  <div class="d-flex">
                                                       <div class="flex-shrink-0">
                                                            <div class="avatar-sm me-2">
                                                                 <span class="avatar-title bg-soft-info text-info fs-20 rounded-circle">
                                                                      D
                                                                 </span>
                                                            </div>
                                                       </div>
                                                       <div class="flex-grow-1">
                                                            <p class="mb-0 fw-semibold">Donoghue Susan</p>
                                                            <p class="mb-0 text-wrap">
                                                                 Hi, How are you? What about our next meeting
                                                            </p>
                                                       </div>
                                                  </div>
                                             </a>
                                             <!-- Item -->
                                             <a href="javascript:void(0);" class="dropdown-item py-3 border-bottom">
                                                  <div class="d-flex">
                                                       <div class="flex-shrink-0">
                                                            <img src="/assets/images/users/avatar-3.jpg" class="img-fluid me-2 avatar-sm rounded-circle" alt="avatar-3" />
                                                       </div>
                                                       <div class="flex-grow-1">
                                                            <p class="mb-0 fw-semibold">Jacob Gines</p>
                                                            <p class="mb-0 text-wrap">Answered to your comment on the cash flow forecast's graph ðŸ””.</p>
                                                       </div>
                                                  </div>
                                             </a>
                                             <!-- Item -->
                                             <a href="javascript:void(0);" class="dropdown-item py-3 border-bottom">
                                                  <div class="d-flex">
                                                       <div class="flex-shrink-0">
                                                            <div class="avatar-sm me-2">
                                                                 <span class="avatar-title bg-soft-warning text-warning fs-20 rounded-circle">
                                                                      <iconify-icon icon="iconamoon:comment-dots-duotone"></iconify-icon>
                                                                 </span>
                                                            </div>
                                                       </div>
                                                       <div class="flex-grow-1">
                                                            <p class="mb-0 fw-semibold text-wrap">You have received <b>20</b> new messages in the
                                                                 conversation</p>
                                                       </div>
                                                  </div>
                                             </a>
                                             <!-- Item -->
                                             <a href="javascript:void(0);" class="dropdown-item py-3 border-bottom">
                                                  <div class="d-flex">
                                                       <div class="flex-shrink-0">
                                                            <img src="/assets/images/users/avatar-5.jpg" class="img-fluid me-2 avatar-sm rounded-circle" alt="avatar-5" />
                                                       </div>
                                                       <div class="flex-grow-1">
                                                            <p class="mb-0 fw-semibold">Shawn Bunch</p>
                                                            <p class="mb-0 text-wrap">
                                                                 Commented on Admin
                                                            </p>
                                                       </div>
                                                  </div>
                                             </a>
                                        </div>
                                        <div class="text-center py-3">
                                             <a href="javascript:void(0);" class="btn btn-primary btn-sm">View All Notification <i class="bx bx-right-arrow-alt ms-1"></i></a>
                                        </div>
                                   </div>
                              </div>

                              <!-- Theme Setting -->
                              <div class="topbar-item d-none d-md-flex">
                                  
                              </div>

                              <!-- Activity -->
                             

                              <!-- User -->
                              <div class="dropdown topbar-item">
                                   
                                   <div class="dropdown-menu dropdown-menu-end">
                                        <!-- item-->
                                        <h6 class="dropdown-header">Welcome Gaston!</h6>
                                        <a class="dropdown-item" href="pages-profile.html">
                                             <i class="bx bx-user-circle text-muted fs-18 align-middle me-1"></i><span class="align-middle">Profile</span>
                                        </a>
                                        <a class="dropdown-item" href="apps-chat.html">
                                             <i class="bx bx-message-dots text-muted fs-18 align-middle me-1"></i><span class="align-middle">Messages</span>
                                        </a>

                                        <a class="dropdown-item" href="pages-pricing.html">
                                             <i class="bx bx-wallet text-muted fs-18 align-middle me-1"></i><span class="align-middle">Pricing</span>
                                        </a>
                                        <a class="dropdown-item" href="pages-faqs.html">
                                             <i class="bx bx-help-circle text-muted fs-18 align-middle me-1"></i><span class="align-middle">Help</span>
                                        </a>
                                        <a class="dropdown-item" href="auth-lock-screen.html">
                                             <i class="bx bx-lock text-muted fs-18 align-middle me-1"></i><span class="align-middle">Lock screen</span>
                                        </a>

                                        <div class="dropdown-divider my-1"></div>

                                        <a class="dropdown-item text-danger">
                                             <i class="bx bx-log-out fs-18 align-middle me-1"></i><span class="align-middle" onclick="handleLogout()"  >Logout</span>
                                        </a>
                                   </div>
                              </div>

                             
                         </div>
                    </div>
               </div>
          </header>

        <!-- Activity Timeline -->
        <div>
             <div class="offcanvas offcanvas-end border-0" tabindex="-1" id="theme-activity-offcanvas" style="max-width: 450px; width: 100%;">
                  <div class="d-flex align-items-center bg-primary p-3 offcanvas-header">
                       <h5 class="text-white m-0 fw-semibold">Activity Stream</h5>
                       <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                  </div>

                  <div class="offcanvas-body p-0">
                       <div data-simplebar class="h-100 p-4">
                            <div class="position-relative ms-2">
                                 <span class="position-absolute start-0  top-0 border border-dashed h-100"></span>
                                 <div class="position-relative ps-4">
                                      <div class="mb-4">
                                           <span class="position-absolute start-0 avatar-sm translate-middle-x bg-danger d-inline-flex align-items-center justify-content-center rounded-circle text-light fs-20"><iconify-icon icon="iconamoon:folder-check-duotone"></iconify-icon></span>
                                           <div class="ms-2">
                                                <h5 class="mb-1 text-dark fw-semibold fs-15 lh-base">Report-Fix / Update </h5>
                                                <p class="d-flex align-items-center">Add 3 files to <span class=" d-flex align-items-center text-primary ms-1"><iconify-icon icon="iconamoon:file-light"></iconify-icon> Tasks</span></p>
                                                <div class="bg-light bg-opacity-50 rounded-2 p-2">
                                                     <div class="row">
                                                          <div class="col-lg-6 border-end border-light">
                                                               <div class="d-flex align-items-center gap-2">
                                                                    <i class="bx bxl-figma fs-20 text-red"></i>
                                                                    <a href="#!" class="text-dark fw-medium">Concept.fig</a>
                                                               </div>
                                                          </div>
                                                          <div class="col-lg-6">
                                                               <div class="d-flex align-items-center gap-2">
                                                                    <i class="bx bxl-file-doc fs-20 text-success"></i>
                                                                    <a href="#!" class="text-dark fw-medium">larkon.docs</a>
                                                               </div>
                                                          </div>
                                                     </div>
                                                </div>
                                                <h6 class="mt-2 text-muted">Monday , 4:24 PM</h6>
                                           </div>
                                      </div>
                                 </div>
                                 <div class="position-relative ps-4">
                                      <div class="mb-4">
                                           <span class="position-absolute start-0 avatar-sm translate-middle-x bg-success d-inline-flex align-items-center justify-content-center rounded-circle text-light fs-20"><iconify-icon icon="iconamoon:check-circle-1-duotone"></iconify-icon></span>
                                           <div class="ms-2">
                                                <h5 class="mb-1 text-dark fw-semibold fs-15 lh-base">Project Status
                                                </h5>
                                                <p class="d-flex align-items-center mb-0">Marked<span class=" d-flex align-items-center text-primary mx-1"><iconify-icon icon="iconamoon:file-light"></iconify-icon> Design </span> as <span class="badge bg-success-subtle text-success px-2 py-1 ms-1"> Completed</span></p>
                                                <div class="d-flex align-items-center gap-3 mt-1 bg-light bg-opacity-50 p-2 rounded-2">
                                                     <a href="#!" class="fw-medium text-dark">UI/UX Figma Design</a>
                                                     <div class="ms-auto">
                                                          <a href="#!" class="fw-medium text-primary fs-18" data-bs-toggle="tooltip" data-bs-title="Download" data-bs-placement="bottom"><iconify-icon icon="iconamoon:cloud-download-duotone"></iconify-icon></a>
                                                     </div>
                                                </div>
                                                <h6 class="mt-3 text-muted">Monday , 3:00 PM</h6>
                                           </div>
                                      </div>
                                 </div>
                                 <div class="position-relative ps-4">
                                      <div class="mb-4">
                                           <span class="position-absolute start-0 avatar-sm translate-middle-x bg-primary d-inline-flex align-items-center justify-content-center rounded-circle text-light fs-16">UI</span>
                                           <div class="ms-2">
                                                <h5 class="mb-1 text-dark fw-semibold fs-15">Larkon Application UI v2.0.0 <span class="badge bg-primary-subtle text-primary px-2 py-1 ms-1"> Latest</span>
                                                </h5>
                                                <p>Get access to over 20+ pages including a dashboard layout, charts, kanban board, calendar, and pre-order E-commerce & Marketing pages.</p>
                                                <div class="mt-2">
                                                     <a href="#!" class="btn btn-light btn-sm">Download Zip</a>
                                                </div>
                                                <h6 class="mt-3 text-muted">Monday , 2:10 PM</h6>
                                           </div>
                                      </div>
                                 </div>
                                 <div class="position-relative ps-4">
                                      <div class="mb-4">
                                           <span class="position-absolute start-0 translate-middle-x bg-success bg-gradient d-inline-flex align-items-center justify-content-center rounded-circle text-light fs-20"><img src="/assets/images/users/avatar-7.jpg" alt="avatar-5" class="avatar-sm rounded-circle"></span>
                                           <div class="ms-2">
                                                <h5 class="mb-0 text-dark fw-semibold fs-15 lh-base">Alex Smith Attached Photos
                                                </h5>
                                                <div class="row g-2 mt-2">
                                                     <div class="col-lg-4">
                                                          <a href="#!">
                                                               <img src="/assets/images/small/img-6.jpg" alt="" class="img-fluid rounded">
                                                          </a>
                                                     </div>
                                                     <div class="col-lg-4">
                                                          <a href="#!">
                                                               <img src="/assets/images/small/img-3.jpg" alt="" class="img-fluid rounded">
                                                          </a>
                                                     </div>
                                                     <div class="col-lg-4">
                                                          <a href="#!">
                                                               <img src="/assets/images/small/img-4.jpg" alt="" class="img-fluid rounded">
                                                          </a>
                                                     </div>
                                                </div>
                                                <h6 class="mt-3 text-muted">Monday 1:00 PM</h6>
                                           </div>
                                      </div>
                                 </div>
                                 <div class="position-relative ps-4">
                                      <div class="mb-4">
                                           <span class="position-absolute start-0 translate-middle-x bg-success bg-gradient d-inline-flex align-items-center justify-content-center rounded-circle text-light fs-20"><img src="/assets/images/users/avatar-6.jpg" alt="avatar-5" class="avatar-sm rounded-circle"></span>
                                           <div class="ms-2">
                                                <h5 class="mb-0 text-dark fw-semibold fs-15 lh-base">Rebecca J. added a new team member
                                                </h5>
                                                <p class="d-flex align-items-center gap-1"><iconify-icon icon="iconamoon:check-circle-1-duotone" class="text-success"></iconify-icon> Added a new member to Front Dashboard</p>
                                                <h6 class="mt-3 text-muted">Monday 10:00 AM</h6>
                                           </div>
                                      </div>
                                 </div>
                                 <div class="position-relative ps-4">
                                      <div class="mb-4">
                                           <span class="position-absolute start-0 avatar-sm translate-middle-x bg-warning d-inline-flex align-items-center justify-content-center rounded-circle text-light fs-20"><iconify-icon icon="iconamoon:certificate-badge-duotone"></iconify-icon></span>
                                           <div class="ms-2">
                                                <h5 class="mb-0 text-dark fw-semibold fs-15 lh-base">Achievements
                                                </h5>
                                                <p class="d-flex align-items-center gap-1 mt-1">Earned a <iconify-icon icon="iconamoon:certificate-badge-duotone" class="text-danger fs-20"></iconify-icon>" Best Product Award"</p>
                                                <h6 class="mt-3 text-muted">Monday 9:30 AM</h6>
                                           </div>
                                      </div>
                                 </div>
                            </div>
                            <a href="#!" class="btn btn-outline-dark w-100">View All</a>
                       </div>
                  </div>
             </div>
        </div>

        <!-- Right Sidebar (Theme Settings) -->
        <div>
             <div class="offcanvas offcanvas-end border-0" tabindex="-1" id="theme-settings-offcanvas">
                  <div class="d-flex align-items-center bg-primary p-3 offcanvas-header">
                       <h5 class="text-white m-0">Theme Settings</h5>
                       <button type="button" class="btn-close btn-close-white ms-auto" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                  </div>

                  <div class="offcanvas-body p-0">
                       <div data-simplebar class="h-100">
                            <div class="p-3 settings-bar">

                                 <div>
                                      <h5 class="mb-3 font-16 fw-semibold">Color Scheme</h5>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-bs-theme" id="layout-color-light" value="light">
                                           <label class="form-check-label" for="layout-color-light">Light</label>
                                      </div>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-bs-theme" id="layout-color-dark" value="dark">
                                           <label class="form-check-label" for="layout-color-dark">Dark</label>
                                      </div>
                                 </div>

                                 <div>
                                      <h5 class="my-3 font-16 fw-semibold">Topbar Color</h5>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-topbar-color" id="topbar-color-light" value="light">
                                           <label class="form-check-label" for="topbar-color-light">Light</label>
                                      </div>
                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-topbar-color" id="topbar-color-dark" value="dark">
                                           <label class="form-check-label" for="topbar-color-dark">Dark</label>
                                      </div>
                                 </div>


                                 <div>
                                      <h5 class="my-3 font-16 fw-semibold">Menu Color</h5>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-menu-color" id="leftbar-color-light" value="light">
                                           <label class="form-check-label" for="leftbar-color-light">
                                                Light
                                           </label>
                                      </div>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-menu-color" id="leftbar-color-dark" value="dark">
                                           <label class="form-check-label" for="leftbar-color-dark">
                                                Dark
                                           </label>
                                      </div>
                                 </div>

                                 <div>
                                      <h5 class="my-3 font-16 fw-semibold">Sidebar Size</h5>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-menu-size" id="leftbar-size-default" value="default">
                                           <label class="form-check-label" for="leftbar-size-default">
                                                Default
                                           </label>
                                      </div>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-menu-size" id="leftbar-size-small" value="condensed">
                                           <label class="form-check-label" for="leftbar-size-small">
                                                Condensed
                                           </label>
                                      </div>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-menu-size" id="leftbar-hidden" value="hidden">
                                           <label class="form-check-label" for="leftbar-hidden">
                                                Hidden
                                           </label>
                                      </div>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-menu-size" id="leftbar-size-small-hover-active" value="sm-hover-active">
                                           <label class="form-check-label" for="leftbar-size-small-hover-active">
                                                Small Hover Active
                                           </label>
                                      </div>

                                      <div class="form-check mb-2">
                                           <input class="form-check-input" type="radio" name="data-menu-size" id="leftbar-size-small-hover" value="sm-hover">
                                           <label class="form-check-label" for="leftbar-size-small-hover">
                                                Small Hover
                                           </label>
                                      </div>
                                 </div>

                            </div>
                       </div>
                  </div>
                  <div class="offcanvas-footer border-top p-3 text-center">
                       <div class="row">
                            <div class="col">
                                 <button type="button" class="btn btn-danger w-100" id="reset-layout">Reset</button>
                            </div>
                       </div>
                  </div>
             </div>
        </div>
        <!-- ========== Topbar End ========== -->

        <!-- ========== App Menu Start ========== -->
        
        <!-- ========== App Menu End ========== -->
        <%- include("../../views/partials/admin/nav") %>

        <!-- ==================================================== -->
        <!-- Start right Content here -->
        <!-- ==================================================== -->

        <div class="page-content">

            <!-- Start Container Fluid -->
            <div class="container-xxl">
               <div class="row">
                   <div class="col-xl-12">
                       <div class="card">
                           <div class="d-flex card-header justify-content-between align-items-center">
                               <div>
                                   <h4 class="card-title">All Customers List</h4>
                               </div>
                               
                               <div>
                                   <form id="customer-search-form" class="app-search d-none d-md-block ms-2">
                                     <div class="d-flex align-items-center">
                                       <input type="search" class="form-control me-2" id="search-input" placeholder="Search by name or email..." autocomplete="off" value="<%= search %>">
                                       
                                     </div>
                                   </form>
                                 </div>
                           </div>
                           <div>
                              <div class="table-responsive">
                                   <table class="table align-middle mb-0 table-hover table-centered">
                                     <thead class="bg-light-subtle">
                                       <tr>
                                         <th style="width: 20px;"></th>
                                         <th>ID</th>
                                         <th>Username</th>
                                         <th>Email</th>
                                         <th>Join Date</th>
                                         <th>Actions</th>
                                       </tr>
                                     </thead>
                                     <tbody id="customer-table-body">
                                       <% for (let i = 0; i < data.length; i++) { %>
                                       <tr>
                                         <td></td>
                                         <td><%= data[i].id %></td>
                                         <td><%= data[i].name %></td>
                                         <td><%= data[i].email %></td>
                                         <td><%= new Date(data[i].date).toLocaleDateString() %></td> 
                                         <td id="customer-action-<%= data[i]._id %>">
                                           <% if (!data[i].isBlocked) { %>
                                             <button 
                                               class="btn btn-danger text-white ajax-block-btn" 
                                               data-id="<%= data[i].id %>" 
                                               data-action="block">
                                               Block
                                             </button>
                                           <% } else { %>
                                             <button 
                                               class="btn btn-success text-white ajax-block-btn" 
                                               data-id="<%= data[i].id %>" 
                                               data-action="unblock">
                                               Unblock
                                             </button>
                                           <% } %>
                                         
                                           <button type="button" class="btn btn-warning">
                                             <a href="/admin/customerdetails?id=<%= data[i]._id %>" style="text-decoration: none; color: white;">
                                               View
                                             </a>
                                           </button>
                                         </td>
                                       </tr>
                                       <% } %>
                                     </tbody>
                                   </table>
                                 </div>
                               <!-- end table-responsive -->
                           </div>
                           <div class="card-footer border-top">
                               <nav aria-label="Page navigation example">
                                   <ul class="pagination justify-content-end mb-0">
                                       <% for (let i = 1; i <= totalPages; i++) { %>
                                       <li class="page-item <%= (i === currentPage) ? 'active' : '' %>">
                                           <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                                       </li>
                                       <% } %>
                                   </ul>
                               </nav>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
           
            <!-- End Container Fluid -->

            <!-- ========== Footer Start ========== -->
            <footer class="footer">
               <div class="container-fluid">
                   <div class="row">
                       <div class="col-12 text-center">
                           <script>document.write(new Date().getFullYear())</script> &copy; Expansy. Created by <iconify-icon icon="iconamoon:heart-duotone" class="fs-18 align-middle text-danger"></iconify-icon> <a
                               href="https://1.envato.market/techzaa" class="fw-bold footer-text" target="_blank">Aswin Variyath</a>
                       </div>
                   </div>
               </div>
           </footer>
           <!-- ========== Footer End ========== -->
           
           </div>
           <!-- ==================================================== -->
           <!-- End Page Content -->
           <!-- ==================================================== -->
           
           </div>
           <!-- END Wrapper -->
           
           
           
           <!-- Vendor Javascript (Require in all Page) -->
           <script src="/assets/js/vendor.js"></script>
           
           <!-- App Javascript (Require in all Page) -->
           <script src="/assets/js/app.js"></script>
           
           <!-- Vector Map Js -->
           <script src="/assets/vendor/jsvectormap/js/jsvectormap.min.js"></script>
           <script src="/assets/vendor/jsvectormap/maps/world-merc.js"></script>
           <script src="/assets/vendor/jsvectormap/maps/world.js"></script>
           
           <!-- Dashboard Js -->
           <script src="/assets/js/pages/dashboard.js"></script>

           

           <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
           <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
           
           <script>
               $(document).ready(function () {
                 $(document).on('click', '.ajax-block-btn', function () {
                   const button = $(this);
                   const userId = button.data('id');
                   const parentCell = button.closest('td'); // Get the parent cell
                   const parentCellId = parentCell.attr('id'); // Get the parent cell ID
                   const action = button.data('action');
                   const isBlocking = action === 'block';
                   const url = isBlocking ? '/admin/blockCustomer' : '/admin/unblockCustomer';
                   
                   console.log("userId:", userId);
                   console.log("parentCellId:", parentCellId);
                   
                   Swal.fire({
                     title: 'Are you sure?',
                     text: isBlocking ? 'Block this customer?' : 'Unblock this customer?',
                     icon: 'warning',
                     showCancelButton: true,
                     confirmButtonText: 'Yes, proceed!',
                     cancelButtonText: 'Cancel',
                   }).then((result) => {
                     if (result.isConfirmed) {
                       $.ajax({
                         type: 'POST',
                         url: url,
                         data: { id: userId },
                         success: function (response) {
                           if (response.success) {
                             // Create new block/unblock button based on the action
                             const newBlockBtn = $('<button>', {
                               class: isBlocking ? 'btn btn-success text-white ajax-block-btn' : 'btn btn-danger text-white ajax-block-btn',
                               'data-id': userId,
                               'data-action': isBlocking ? 'unblock' : 'block',
                               text: isBlocking ? 'Unblock' : 'Block'
                             });
                             
                             // Create new view button
                             const newViewBtn = $('<button>', {
                               type: 'button',
                               class: 'btn btn-warning ml-2'
                             }).append(
                               $('<a>', {
                                 href: `/admin/customerdetails?id=${parentCellId.replace('customer-action-', '')}`,
                                 style: 'text-decoration: none; color: white;',
                                 text: 'View'
                               })
                             );
                             
                             // Clear the cell and append the new buttons
                             parentCell.empty().append(newBlockBtn).append(' ').append(newViewBtn);
                             
                             // Log the success message
                             console.log("Customer status updated successfully");
                             
                             Swal.fire('Success', response.message || 'Customer status updated.', 'success');
                           } else {
                             Swal.fire('Error', response.message || 'Failed to update status.', 'error');
                           }
                         },
                         error: function (xhr) {
                           const errorMsg = xhr.responseJSON?.message || 'Something went wrong.';
                           Swal.fire('Error', errorMsg, 'error');
                         }
                       });
                     }
                   });
                 });
               });
               </script>

<script>
     $(document).ready(function() {
       // Search functionality
       $('#search-button').on('click', function() {
         performSearch();
       });
       
       // Search on Enter key
       $('#search-input').on('keypress', function(e) {
         if (e.which === 13) {
           e.preventDefault();
           performSearch();
         }
       });
       
       function performSearch() {
         const searchQuery = $('#search-input').val().trim();
         const currentPage = `<%= currentPage %>` || 1;
         
         // Show loading indicator
         $('#customer-table-body').html('<tr><td colspan="6" class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div></td></tr>');
         
         $.ajax({
           url: '/admin/search-customers',
           method: 'GET',
           data: {
             search: searchQuery,
             page: currentPage
           },
           success: function(response) {
             if (response.success) {
               // Update table with search results
               updateCustomerTable(response.data, response.currentPage, response.totalPages);
               
               // Update pagination
               updatePagination(response.currentPage, response.totalPages, searchQuery);
               
               // Update URL to reflect search (for bookmarking)
               updateURLWithSearchParams(searchQuery, response.currentPage);
             } else {
               $('#customer-table-body').html('<tr><td colspan="6" class="text-center">No results found</td></tr>');
             }
           },
           error: function(xhr) {
             console.error('Search error:', xhr);
             
             // Show error message
             Swal.fire({
               title: 'Error',
               text: 'Failed to perform search. Please try again.',
               icon: 'error'
             });
             
             // Restore table with default data
             $('#customer-table-body').html('<tr><td colspan="6" class="text-center">Error loading data</td></tr>');
           }
         });
       }
       
       function updateCustomerTable(customers, currentPage, totalPages) {
         const tableBody = $('#customer-table-body');
         tableBody.empty();
         
         if (customers.length === 0) {
           tableBody.html('<tr><td colspan="6" class="text-center">No customers found</td></tr>');
           return;
         }
         
         $.each(customers, function(index, customer) {
           const row = $('<tr>');
           
           // Add cells
           row.append($('<td>')); // Empty first column
           row.append($('<td>').text(customer.id));
           row.append($('<td>').text(customer.name));
           row.append($('<td>').text(customer.email));
           row.append($('<td>').text(new Date(customer.date).toLocaleDateString()));
           
           // Actions cell
           const actionsCell = $('<td>').attr('id', 'customer-action-' + customer._id);
           
           // Create block/unblock button
           const blockBtn = $('<button>', {
             class: customer.isBlocked ? 'btn btn-success text-white ajax-block-btn' : 'btn btn-danger text-white ajax-block-btn',
             'data-id': customer.id,
             'data-action': customer.isBlocked ? 'unblock' : 'block',
             text: customer.isBlocked ? 'Unblock' : 'Block'
           });
           
           // Create view button
           const viewBtn = $('<button>', {
             type: 'button',
             class: 'btn btn-warning ml-2'
           }).append(
             $('<a>', {
               href: '/admin/customerdetails?id=' + customer._id,
               style: 'text-decoration: none; color: white;',
               text: 'View'
             })
           );
           
           // Add buttons to cell
           actionsCell.append(blockBtn).append(' ').append(viewBtn);
           row.append(actionsCell);
           
           // Add row to table
           tableBody.append(row);
         });
       }
       
       function updatePagination(currentPage, totalPages, searchQuery) {
         const pagination = $('.pagination');
         pagination.empty();
         
         for (let i = 1; i <= totalPages; i++) {
           const pageItem = $('<li>', {
             class: 'page-item' + (i === currentPage ? ' active' : '')
           });
           
           const pageLink = $('<a>', {
             class: 'page-link',
             href: '?page=' + i + (searchQuery ? '&search=' + searchQuery : ''),
             text: i
           });
           
           // Add click event for pagination
           pageLink.on('click', function(e) {
             e.preventDefault();
             loadPage(i, searchQuery);
           });
           
           pageItem.append(pageLink);
           pagination.append(pageItem);
         }
       }
       
       function loadPage(page, searchQuery) {
         $.ajax({
           url: '/admin/search-customers',
           method: 'GET',
           data: {
             search: searchQuery || '',
             page: page
           },
           success: function(response) {
             if (response.success) {
               updateCustomerTable(response.data, response.currentPage, response.totalPages);
               updatePagination(response.currentPage, response.totalPages, searchQuery);
               updateURLWithSearchParams(searchQuery, response.currentPage);
             }
           },
           error: function(xhr) {
             console.error('Page load error:', xhr);
             Swal.fire({
               title: 'Error',
               text: 'Failed to load page. Please try again.',
               icon: 'error'
             });
           }
         });
       }
       
       function updateURLWithSearchParams(searchQuery, page) {
         if (history.pushState) {
           const newUrl = window.location.protocol + "//" + window.location.host + 
                          window.location.pathname + 
                          '?page=' + page + 
                          (searchQuery ? '&search=' + encodeURIComponent(searchQuery) : '');
           window.history.pushState({ path: newUrl }, '', newUrl);
         }
       }
     });
     </script>
               
               <script>
                    function confirmAction(url, action) {
                        const actionText = action === 'block' ? 'block' : 'unblock';
                        if (confirm(`Are you sure you want to ${actionText} this product?`)) {
                            window.location.href = url;
                        }
                    }
                    </script>
           </body>
           
           
           <!-- Mirrored from techzaa.in/larkon/admin/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 03 Dec 2024 05:42:46 GMT -->
           </html>